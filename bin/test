#!/usr/bin/env bash

set -Eeuo pipefail

cd "$(dirname "$0")/.."

. ./krab

# Aggregate test results.
total=0
failures=0
for test in ./tests/*; do
    total=$((total + 1))
    krab_stdio_state "Running test $test..."
    if $test; then
        krab_stdio_confirm "TEST $test PASSED"
     else
        failures=$((failures + 1))
        krab_stdio_alert "TEST $test FAILED"
    fi
done

if [ $failures -eq 0 ]
then
    krab_stdio_confirm "SUCCESS: $total TEST(S) PASSED."
    exit
else
    krab_stdio_alert "ERROR: $failures OUT OF $total TEST(S) FAILED."
    exit 1
fi
